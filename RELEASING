# release process for pptp and pptp-extras package (ppp below)
# emacs: sh-mode

# make local repository up to date in case of other changes
git pull

# set shell variables for version
# (use -rc1 for release candidate 1, or blank for final release)
VERSION=1.9.0
RELEASE=

export VERSION RELEASE
echo "VERSION=${VERSION} RELEASE=${RELEASE}"

# check and fix versions
egrep "VERSION=|RELEASE=" Makefile
emacsclient Makefile

# update ChangeLog and NEWS with a release date
emacsclient NEWS
emacsclient ChangeLog
git commit -m "release $VERSION$RELEASE" NEWS ChangeLog Makefile

# tag
git tag ${VERSION}

# mkdist
make dist
mv pptp-${VERSION}${RELEASE}.tar.gz ../

# publish
cd ~/public_html/external/mine/pptp/
cp /home/james/pptp-client/pptp-${VERSION}${RELEASE}.tar.gz ./

gpg --detach-sign --armor --default-key ae2466c0 pptp-${VERSION}${RELEASE}.tar.gz 
mv pptp-${VERSION}${RELEASE}.tar.gz.asc pptp-${VERSION}${RELEASE}.tar.gz.signature

# update http://pptpclient.sourceforge.net/#download

# compose release candidate announcement
# To: pptpclient-devel@lists.sourceforge.net		(candidates)
# To: pptpclient-announce@lists.sourceforge.net		(final)
# From: James Cameron <james.cameron@hp.com>
# Subject: pptp-${VERSION}${RELEASE} released
# ...
# include NEWS
# point at release candidate pages
# http://quozl.netrek.org/pptp/
# http://quozl.linux.org.au/pptp/
# sign mail

mutt -s "pptp-1.9.0 released" pptpclient-devel@lists.sourceforge.net <<EOF
G'day,

PPTP Client 1.9.0 is released.

Changes since 1.8.0 are:

- close a memory leak in pqueue,
- avoid spurious error about /bin/ip on FreeBSD,
- fix compiler warnings,
- avoid clobbering heap (RHBZ #1183627),
- fix use after free in call close request handler,
- make clean to clean pptpsetup.8 (Debian #831032),
- add --missing-window option (Debian #680455, Ubuntu #681617),
- randomise call-id (Debian #721963),
- replace gethostbyname(3) with getaddrinfo(3),
- fix typo in pptp_ctrl manpage,
- place pptpsetup manpage in correct section,
- don't set build flags; use defaults,
- remove pptpsetup.8 from source as it is generated,
- fix for (null) in "pptp: GRE-to-PPP gateway on (null)".

Can be downloaded from:
	https://sourceforge.net/projects/pptpclient/files/pptp/pptp-1.9.0/
	https://quozl.linux.org.au/pptp/

b2117b377f65294a9786f80f0235d308  pptp-1.9.0.tar.gz
EOF

# todo, version matrix, linux distribution down left side, pptp & ppp top,
# then a link to instructions
